<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Compass & Qibla UI</title>
  <link rel="apple-touch-icon" type="image/png" href="https://cpwebassets.codepen.io/assets/favicon/apple-touch-icon-5ae1a0698dcc2402e9712f7d01ed509a57814f994c660df9f7a952f3060705ee.png" />
  <link rel="icon" type="image/x-icon" href="https://cpwebassets.codepen.io/assets/favicon/favicon-aec34940fbc1a6e787974dcd360f2c6b63348d4b1f4e06c77743096d55480f33.ico" />
  <link rel="mask-icon" type="image/x-icon" href="https://cpwebassets.codepen.io/assets/favicon/logo-pin-b4b4269c16397ad2f0f7a01bcdf513a1994f4c94b8af2f191c09eb0d601762b1.svg" color="#111" />
  <style>
    @import url("https://fonts.googleapis.com/css?family=Wallpoet");
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }
    body {
      margin: 30px;
      background: #0f0f0f;
      color: #86fe19;
      text-shadow: 0 0 rgba(134, 254, 25, 0.5);
      font-family: "Wallpoet", cursive;
      text-align: center;
    }
    .compass {
      position: relative;
      width: 260px;
      height: 260px;
      margin: 20px auto;
      background: #222;
      padding: 20px;
      border-radius: 40px;
      border: 5px solid #444;
      overflow: hidden;
    }
    /* The disc rotates with the device heading */
    .compass .disc {
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 200;
      background-image: url(data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYWFnXzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IiB3aWR0aD0iODg1LjM4NnB4IiBoZWlnaHQ9Ijg4NS4zODVweCIgdmlld0JveD0iMCAwIDg4NS4zODYgODg1LjM4NSIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgODg1LjM4NiA4ODUuMzg1IiB4bWw6c3BhY2U9InByZXNlcnZlIj48Y2lyY2xlIGZpbGw9IiNCRTE2MjIiIGN4PSI0NDIuNjkyIiBjeT0iNDQyLjY5MyIgcj0iNDI1LjYyMiIvPjxjaXJjbGUgZmlsbD0iIzQwOEFBNyIgY3g9IjQ0Mi42OTMiIGN5PSI0NDIuNjkzIiByPSIzODYuOTI5Ii8+PGNpcmNsZSBmaWxsPSJub25lIiBzdHJva2U9IiMxQzc4OTQiIHN0cm9rZS13aWR0aD0iMzcwIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHN0cm9rZS1kYXNoYXJyYXk9IjI4LjU3MzUsMjcuNTg4MiIgY3g9IjQ0Mi42OTIiIGN5PSI0NDIuNjkzIiByPSIyNTAuMjY2Ii8+PGNpcmNsZSBmaWxsPSJub25lIiBzdHJva2U9IiM0MDhBQTciIHN0cm9rZS13aWR0aD0iMjAiIHN0cm9rZS1saW5lam9pbj0iYmV2ZWwiIGN4PSI0NDIuNjkzIiBjeT0iNDQyLjY5MyIgcj0iMzkwLjU2NiIvPjxwYXRoIGZpbGw9IiNGMUYyQzQiIGQ9Ik00NDIuNjkzLDI2YzIzMC4xMzIsMCw0MTYuNjkyLDE4Ni41Niw0MTYuNjkyLDQxNi42OTNjMCwyMzAuMTM0LTE4Ni41NjEsNDE2LjY5Mi00MTYuNjkyLDQxNi42OTJDMjEyLjU2LDg1OS4zODUsMjYsNjcyLjgyNywyNiw0NDIuNjkzQzI2LDIxMi41NiwyMTIuNTYsMjYsNDQyLjY5MywyNiBNNDQyLjY5MywwYy01OS43NTIsMC0xMTcuNzMsMTEuNzA4LTE3Mi4zMjQsMzQuOGMtNTIuNzE5LDIyLjI5OC0xMDAuMDYsNTQuMjE0LTE0MC43MDcsOTQuODYyQzg5LjAxNCwxNzAuMzEsNTcuMDk4LDIxNy42NSwzNC44LDI3MC4zNjlDMTEuNzA4LDMyNC45NjMsMCwzODIuOTQxLDAsNDQyLjY5M3MxMS43MDgsMTE3LjczLDM0LjgsMTcyLjMyNGMyMi4yOTgsNTIuNzE5LDU0LjIxNCwxMDAuMDYsOTQuODYyLDE0MC43MDdjNDAuNjQ3LDQwLjY0Nyw4Ny45ODgsNzIuNTYzLDE0MC43MDcsOTQuODYxYzU0LjU5NCwyMy4wOTIsMTEyLjU3MiwzNC44LDE3Mi4zMjQsMzQuOHMxMTcuNzI5LTExLjcwOCwxNzIuMzIzLTM0LjhjNTIuNzE5LTIyLjI5OCwxMDAuMDYtNTQuMjE0LDE0MC43MDctOTQuODYxczcyLjU2NC04Ny45ODgsOTQuODYyLTE0MC43MDdjMjMuMDkyLTU0LjU5NCwzNC44LTExMi41NzIsMzQuOC0xNzIuMzI0cy0xMS43MDgtMTE3LjczLTM0LjgtMTcyLjMyNGMtMjIuMjk4LTUyLjcxOS01NC4yMTUtMTAwLjA1OS05NC44NjItMTQwLjcwN0M3MTUuMDc2LDg5LjAxNCw2NjcuNzM1LDU3LjA5OCw2MTUuMDE3LDM0LjhDNTYwLjQyMywxMS43MDgsNTAyLjQ0NCwwLDQ0Mi42OTMsMEw0NDIuNjkzLDB6Ii8+PGJvbHlnb24gZmlsbD0iIzFDNzg5NCIgcG9pbnRzPSI0NDIuNjk0LDM4MC4xOTUgNTMxLjA4MSwzNTQuMzA0IDUwNS4xOTQsNDQyLjY5MiA1MzEuMDgyLDUzMS4wODIgNDQyLjY5NCw1MDUuMTkyIDM1NC4zMDYsNTMxLjA4MiAzODAuMTkyLDQ0Mi42OTEgMzU0LjMwNCwzNTQuMzA0Ii8+PHRleHQgdHJhbnNmb3JtPSJtYXRyaXgoMSAwIDAgMSA4NS43NjM3IDQ1OS44Nzc0KSIgZmlsbD0iI0YxRjJDNCIgZm9udC1mYW1pbHk9IidDZW50dXJ5JyIgZm9udC1zaXplPSI2MiI+VzwvdGV4dD48dGV4dCB0cmFuc2Zvcm09Im1hdHJpeCgxIDAgMCAxIDQxNy40Mjk3IDc4MC42MDk5KSIgZmlsbD0iI0YxRjJDNCIgZm9udC1mYW1pbHk9IidDZW50dXJ5JyIgZm9udC1zaXplPSI2MiI+UzwvdGV4dD48dGV4dCB0cmFuc2Zvcm09Im1hdHJpeCgxIDAgMCAxIDc0OS4wOTU3IDQ1OS44Nzc0KSIgZmlsbD0iI0YxRjJDNCIgZm9udC1mYW1pbHk9IidDZW50dXJ5JyIgZm9udC1zaXplPSI2MiI+RTwvdGV4dD48dGV4dCB0cmFuc2Zvcm09Im1hdHJpeCgxIDAgMCAxIDQxNy40Mjk3IDEzOS4xNDUpIiBmaWxsPSIjRjFGMkM0IiBmb250LWZhbWlseT0iJ0NlbnR1cnknIiBmb250LXNpemU9IjYyIj5OPC90ZXh0Pjwvc3ZnPg==);
      width: 260px;
      height: 260px;
      background-size: 100%;
    }
    /* The Qibla arrow overlays on top of the disc */
    .compass .arrow {
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 1000;
      /* Initially no rotation */
      transform: rotate(0deg);
      transform-origin: center;
      width: 260px;
      height: 260px;
      background-image: url(data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYWFnXzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IiB3aWR0aD0iODg1LjM4N3B4IiBoZWlnaHQ9Ijg4NS4zODVweCIgdmlld0JveD0iMCAwIDg4NS4zODcgODg1LjM4NSIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgODg1LjM4NyA4ODUuMzg1IiB4bWw6c3BhY2U9InByZXNlcnZlIj48bGluZSBmaWxsPSJub25lIiBzdHJva2U9IiMxQzc4OTQiIHN0cm9rZS13aWR0aD0iNS42Mjg1IiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHgxPSI0NDYuMTE0IiB5MT0iMzg2LjMxNCIgeDI9IjQ0Ni4xMTQiIHkyPSI0OTguNCIvPjxwb2x5Z29uIGZpbGw9IiMxQzc4OTQiIHBvaW50cz0iNDAzLjY5Niw0NDAuNTk0IDQ0Ni4xMTQsMTI3LjIwNyA0ODguNTMxLDQ0MC41OTQiLz48cG9seWdvbiBmaWxsPSIjMUM3ODk0IiBwb2ludHM9IjQwMy42OTcsNDQwLjM1NyA0NDYuMTE0LDc1OC4wMTUgNDg4LjUzLDQ0MC4zNTciLz48Y2lyY2xlIGZpbGw9IiMxQzc4OTQiIGN4PSI0NDYuMTE1IiBjeT0iNDQ0LjExIiByPSIxMi41MDEiLz48Y2lyY2xlIGZpbGw9IiMxQzc4OTQiIGN4PSI0NDYuMTE0IiBjeT0iNDQ0LjExIiByPSI5Ii8+PGxpbmUgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjQkUxNjIyIiBzdHJva2Utd2lkdGg9IjUuNjI4NSIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiB4MT0iNDQyLjEwNiIgeTE9IjM4Ni4zMTQiIHgyPSI0NDIuMTA1IiB5Mj0iNDk4LjQiLz48cG9seWdvbiBmaWxsPSIjQkUxNjIyIiBwb2ludHM9IjM5OS42ODgsNDQwLjU5NCA0NDIuMTA2LDEyNy4yMDggNDg0LjUyMiw0NDAuNTk0Ii8+PHBvbHlnb24gZmlsbD0iI0Y2RjZGNiIgcG9pbnRzPSIzOTkuNjg4LDQ0MC4zNTYgNDQyLjEwNSw3NTguMDE0IDQ4NC41MjIsNDQwLjM1OCIvPjxjaXJjbGUgZmlsbD0iIzFDNzg5NCIgY3g9IjQ0Mi4xMDYiIGN5PSI0NDQuMTExIiByPSIxMi41MDEiLz48Y2lyY2xlIGZpbGw9IiM0MDhBQTciIGN4PSI0NDIuMTA2IiBjeT0iNDQ0LjExIiByPSI5Ii8+PC9zdmc+);
      background-size: 100%;
      /* Ensure the arrow overlays on top */
      pointer-events: none;
    }
  </style>
  <script>
    window.console = window.console || function(t) {};
  </script>
</head>
<body translate="no">
  <h1>Compass</h1>
  <div class="compass">
    <div class="arrow"></div>
    <div class="disc" id="compassDiscImg"></div>
  </div>
  <div class="orientation-data">
    <div>Beta: <span id="tiltFB"></span></div>
    <div>Gamma: <span id="tiltLR"></span></div>
    <div>Alpha: <span id="direction"></span></div>
    <div>Qibla Arrow Rotation: <span id="qiblaRotation"></span>°</div>
  </div>
  <div id="notice"></div>
  
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Fixed Qibla angle (set to 98° in this example)
      const qiblaAngle = 98;
      
      if (window.DeviceOrientationEvent) {
        document.getElementById('notice').innerHTML = 'Working API detected';
        window.addEventListener('deviceorientation', eventData => {
          // Retrieve orientation values
          const tiltLR = eventData.gamma;
          const tiltFB = eventData.beta;
          const dir = eventData.alpha;
          deviceOrientationHandler(tiltLR, tiltFB, dir);
        }, false);
      } else {
        document.getElementById('notice').innerHTML = 'No API detected';
      }

      function deviceOrientationHandler(tiltLR, tiltFB, dir) {
        // Display the sensor data
        document.getElementById('tiltLR').innerHTML = Math.ceil(tiltLR);
        document.getElementById('tiltFB').innerHTML = Math.ceil(tiltFB);
        document.getElementById('direction').innerHTML = Math.ceil(dir);
        
        // Rotate the disc element according to the device's heading (alpha)
        const compassDisc = document.getElementById('compassDiscImg');
        compassDisc.style.transform = `rotate(${dir}deg)`;
        compassDisc.style.webkitTransform = `rotate(${dir}deg)`;
        compassDisc.style.MozTransform = `rotate(${dir}deg)`;
        
        // Calculate relative rotation for the Qibla arrow:
        // When the device heading equals the Qibla angle, arrow rotation = 0.
        let arrowRotation = (qiblaAngle - dir + 360) % 360;
        document.getElementById('qiblaRotation').textContent = arrowRotation.toFixed(2);
        
        const arrowElem = document.querySelector('.compass .arrow');
        arrowElem.style.transform = `rotate(${arrowRotation}deg)`;
        arrowElem.style.webkitTransform = `rotate(${arrowRotation}deg)`;
        arrowElem.style.MozTransform = `rotate(${arrowRotation}deg)`;
      }
    });
  </script>
</body>
</html>
